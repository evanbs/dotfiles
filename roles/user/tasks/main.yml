---
- name: Ensure .ssh directory exists for current user
  file:
    path: "/home/{{ dev_username }}/.ssh"
    state: directory
    owner: "{{ dev_username }}"
    group: "{{ dev_username }}"
    mode: '0700'

- name: Ensure default bashrc adds brew to PATH if missing
  copy:
    dest: "/home/{{ dev_username }}/.bashrc"
    content: |
      # Managed by Ansible
      export PATH="$PATH:{{ brew_prefix }}/bin"
      
      # Auto-start zsh if not already running
      # This ensures zsh starts even if the default shell isn't set correctly
      if [ -z "$ZSH_VERSION" ] && [ -f {{ brew_prefix }}/bin/zsh ]; then
        export SHELL={{ brew_prefix }}/bin/zsh
        exec {{ brew_prefix }}/bin/zsh -l
      elif [ -z "$ZSH_VERSION" ] && [ -f /usr/bin/zsh ]; then
        export SHELL=/usr/bin/zsh
        exec /usr/bin/zsh -l
      fi
    owner: "{{ dev_username }}"
    group: "{{ dev_username }}"
    mode: '0644'
    force: no

- name: Ensure workspace directory exists
  file:
    path: "/home/{{ dev_username }}/workspace"
    state: directory
    owner: "{{ dev_username }}"
    group: "{{ dev_username }}"
    mode: '0755'

- name: Ensure downloads directory exists
  file:
    path: "/home/{{ dev_username }}/downloads"
    state: directory
    owner: "{{ dev_username }}"
    group: "{{ dev_username }}"
    mode: '0755'
