- hosts: localhost
  become: true
  vars:
    dev_username: "{{ dev_username | default(lookup('env','SUDO_USER') or lookup('env','USER')) }}"
    brew_prefix: "/home/linuxbrew/.linuxbrew"

  pre_tasks:
    - name: Ensure community.general collection is installed
      ansible.builtin.command: ansible-galaxy collection install community.general
      run_once: true
      delegate_to: localhost
      changed_when: false
      tags:
        - always

  roles:
    - role: user
      tags: ['user', 'base']

    - role: sudo
      tags: ['sudo', 'base']
      when: install_sudo_rules | bool

    - role: homebrew
      tags: ['homebrew', 'packages']
      when: install_homebrew | bool

    - role: zsh
      tags: ['zsh', 'shell']
      when: install_zsh | bool

    - role: ohmyzsh
      tags: ['zsh', 'shell']
      when: install_zsh | bool

    - role: starship
      tags: ['starship', 'prompt']
      when: install_starship | bool

    - role: node
      tags: ['node', 'packages']
      when: install_node | bool

    - role: biome
      tags: ['biome', 'packages']
      when: install_biome | bool

    - role: sdkman
      tags: ['sdkman', 'packages']
      when: install_sdkman | bool

    - role: kvm
      tags: ['kvm', 'virtualization']
      when: install_kvm | bool

    - role: android_sdk
      tags: ['android-sdk', 'packages']
      when: install_android_sdk | bool

    - role: android_studio
      tags: ['android-studio', 'applications']
      when: install_android_studio | bool

    - role: gemini_cli
      tags: ['gemini-cli', 'cli-tools']
      when: install_gemini_cli | bool

    - role: docker
      tags: ['docker', 'containerization']
      when: install_docker | bool

    - role: rust
      tags: ['rust', 'languages']
      when: install_rust | bool

    - role: dotfiles
      tags: ['dotfiles', 'config']
      when: install_dotfiles | bool

    - role: ssh
      tags: ['ssh', 'security']
      when: install_ssh_config | bool


